<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Untitled Document</title><link href="piano.css" rel="stylesheet" type="text/css" /><cfparam name="work" default="0"><cfparam name="numberOfRecordings" default="0"><!--- set up cfajax proxy, using JSON cfc ---><cfajaxproxy cfc="cageJSON" jsclassname="cageJSON"><!--- set up jQuery ---><script type="text/javascript" src= "http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script><!--- init normal CFC for non ajax calls and get pianoworks ---><cfscript>cage = CreateObject("Component","cage");cage.init();pianoWorks = cage.getPianoWorks();</cfscript>   <style>  #loading { display:none; position:fixed; left:0; top:0; width:100%; height:100%;           background-image:url("transparentbg.png"); }#IMG { width: 24px;   height: 24px;   position: absolute;   left: 50%;   top: 50%;   margin-left: -12.5px;   margin-top: -12.5px;	 }		     </style><script type="text/javascript">			var workName = '';			var workDateString = '';			var workLengthString = '';			var workGeneralComments = '';			var currentWork;			var recordingsCOPY;			var recordingsWORKING;			var recordingsWORKING_ADD;			var recordingADD = new Array();						function getAllDetails(work){								getWorkDetails(work);				//getRecordings(work);															}									var getWorkDetails = function(work){				 $("#loading").show();				currentWork = work;			 	var cageProxy = new cageJSON();				cageProxy.setCallbackHandler(getWorkDetailsReturn);				cageProxy.setErrorHandler(myErrorHandler); 				cageProxy.getWorkDetails(work);			}									var getWorkDetailsReturn = function(workDetails)				{				 $('#firstMessage').hide();				workName = workDetails.DATA[0][0];					workDateString = workDetails.DATA[0][5];				workLengthString = workDetails.DATA[0][6];				workGeneralComments = workDetails.DATA[0][7];							//var permiere = workDetails.DATA[0][5];				var htmlString = '<h1>'+workName+'</h1>';				htmlString += '<table width="750" border="1">';				htmlString += '   <table width="750" border="1"><tr class="even">';				htmlString += '<td width="50">'+workDateString+'</td>';				htmlString += '<td width="50">'+workLengthString+'</td>';				htmlString += '<td width="500">'+workGeneralComments+'</td>';				htmlString += '</tr></table>';				document.getElementById('workDetails').innerHTML = htmlString;				$('#workDetails').show();				 $("#loading").show();				// call get recordings here ----				getRecordings(currentWork);				}									var getRecordings = function(work){				$('#recordings').hide();				 $("#allRecording").hide();				$("#loading").show();				var cageProxy = new cageJSON();				cageProxy.setCallbackHandler(getRecordingsReturn);				cageProxy.setErrorHandler(myErrorHandler); 				cageProxy.getRecordings(work);										}						var seeAllRecordings = function(){				$('#recordings').hide();				$("#allRecording").show();			}						var getRecordingsReturn = function(recordings){				 				var numberOfRecordings = recordings.DATA.length;								recordingsCOPY = recordings.DATA;				recordingsWORKING = recordings.DATA;								var randomRecording = Math.floor((Math.random()*numberOfRecordings));				if (numberOfRecordings){					//alert('there are recordings');					$('#filter').show();					var recordTitle = recordings.DATA[randomRecording][1];					var recordPerformers = recordings.DATA[randomRecording][7];					var fileName = recordings.DATA[randomRecording][3];					var recordLabel = recordings.DATA[randomRecording][4];					htmlString =  ' <br /><br />';					htmlString += ' <p> There are ' +numberOfRecordings + ' recordings of ' + workName + ' in our database</p>' ;					htmlString += ' <p> Here is a random recording.</p>';					htmlString += '<table width="500" border="1">';					htmlString += '<tr class="even">';					htmlString += '<td>' + recordTitle + '</td>';					htmlString += '<td>' + recordPerformers + '</td>';					htmlString += '<td width="255"><img src="../db_images/Discog/Discimages/' + fileName + '"/></td>';					htmlString += '<td>' + recordLabel + '</td>';										if (numberOfRecordings > 1){					  htmlString += '<td> <a href = "javascript:getRecordings(currentWork)">Select Another </a></td>';					  htmlString += '</tr><tr><td><a href = "javascript:seeAllRecordings()"> See All Recordings</a></td></tr>';					}					htmlString += '</table>';					document.getElementById("recordings").innerHTML = htmlString; 										// set up all recordings table										for(i=0;i<recordings.DATA.length;i++){ 						var row = document.createElement("tr");						var cell1 = document.createElement("td");						var cell2 = document.createElement("td");						cell1.innerHTML = '<i>' + recordings.DATA[i][1] +'</i>';						cell2.innerHTML = '<img src="../db_images/Discog/Discimages/' + recordings.DATA[i][3] + '">';						row.appendChild(cell1);						row.appendChild(cell2);						document.getElementById("recordingsTable").appendChild(row);					}															$('#recordings').show();					 $("#loading").hide();					 				}else{										htmlString =  ' <br /><br />';					htmlString += ' <p>There are no recordings of ' + workName +'!';					$('#filter').hide();					document.getElementById("recordings").innerHTML = htmlString; 																									 $("#loading").hide();					$('#recordings').show();														}			}						var runFilter = function(){				foo = $('#selectTest').val();				console.log(foo);				for(i=0;i<recordingsCOPY.length;i++){ 				var stringCopy = recordingsCOPY[i][6];				if(stringCopy == 'LP'){				recordingsCOPY.splice(i,1);									}				console.log(stringCopy);				}						}						var applyMediumFilter = function(value){				foo = $('#selectTest').val();												recordingsWORKING = recordingsCOPY.clone();				//recordingsWORKING_ADD = recordingsCOPY.clone();				recordingADD.length = 0;				var length = recordingsWORKING.length;								for(i=0;i<length;i++){ 				var stringCopy = recordingsWORKING[i][6];				if(stringCopy == value){				recordingADD.splice(1,0,recordingsWORKING[i]);					}				}				// subtract from array..				for(i=length-1;i>=0;i--) {				var stringCopy = recordingsWORKING[i][6];				if(stringCopy != value){				recordingsWORKING.splice(i,1);					}					}				console.log(stringCopy);										}						Object.prototype.clone = function() {			  var newObj = (this instanceof Array) ? [] : {};			  for (i in this) {				if (i == 'clone') continue;				if (this[i] && typeof this[i] == "object") {				  newObj[i] = this[i].clone();				} else newObj[i] = this[i]			  } return newObj;			};												  // Error handler for the asynchronous functions.             var myErrorHandler = function(statusCode, statusMsg)             {                 alert('Status: ' + statusCode + ', ' + statusMsg);             } </script><!---- get selected work details ---><!--- get recordings, if any....---></head><body><div class="container"><!--- sidebar --->  <div class="sidebar1">    <ul class="nav">    	<cfoutput query="pianoWorks">      <li><a href="javascript:getAllDetails(#pianoworks.work_ID#);">#pianoWorks.Work_Title#</a></li>      </cfoutput>    </ul>    </div>       <!--- end sidebar --->         <div class="content">	<div id="loading">  <p><img src="ajax-loader.gif" id="IMG" /> Please Wait</p></div>  <div class="firstMessage" id="firstMessage">    <h1>Instructions</h1>    <p>Select a prepared piano work on the left, and further information about that work will appear here.</p>    </div>	<div class="workDetails" id="workDetails">  <!--- here --->       </div>   <div class="recordings" id="recordings"></div>   <div id="filter">    <a href="javascript:runFilter()"> Run Filter ---></a> <select name="medium" onchange="applyMediumFilter(this.value)" id="selectTest">     <option value="0" label="All Media" selected="selected">    <option value="CD" label="CD">    <option value="LP" label="LP">    <option value="TAPE" label="TAPE">     </select></div>   <div id="allRecording">           <table id="recordingsTable">           </table>   </div>       <!-- end .content --></div>  <!-- end .container --></div> <script type="text/javascript">	$(document).ready(function(e) {        $('#firstMessage').show();		$('#workDetails').hide();		$('#recordings').hide();		 $("#loading").hide();		  $("#allRecording").hide();		  $('#filter').hide();    });	</script>  </body></html>