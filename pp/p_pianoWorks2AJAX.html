<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Untitled Document</title><link href="piano.css" rel="stylesheet" type="text/css" /><cfparam name="work" default="0"><cfparam name="numberOfRecordings" default="0"><!--- set up cfajax proxy, using JSON cfc ---><cfajaxproxy cfc="cageJSON" jsclassname="cageJSON"><!--- set up jQuery ---><script type="text/javascript" src= "http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script><!--- init normal CFC for non ajax calls and get pianoworks ---><cfscript>cage = CreateObject("Component","cage");cage.init();pianoWorks = cage.getPianoWorks();</cfscript> <script type="text/javascript">			var workName = '';			var workDateString = '';			var workLengthString = '';			var workGeneralComments = '';			var currentWork;						function getAllDetails(work){								getWorkDetails(work);				//getRecordings(work);															}									var getWorkDetails = function(work){				currentWork = work;			 	var cageProxy = new cageJSON();				cageProxy.setCallbackHandler(getWorkDetailsReturn);				cageProxy.setErrorHandler(myErrorHandler); 				cageProxy.getWorkDetails(work);			}									var getWorkDetailsReturn = function(workDetails)				{				 $('#firstMessage').hide();				workName = workDetails.DATA[0][0];					workDateString = workDetails.DATA[0][5];				workLengthString = workDetails.DATA[0][6];				workGeneralComments = workDetails.DATA[0][7];							//var permiere = workDetails.DATA[0][5];				var htmlString = '<h1>'+workName+'</h1>';				htmlString += '<table width="750" border="1">';				htmlString += '   <table width="750" border="1"><tr class="even">';				htmlString += '<td width="50">'+workDateString+'</td>';				htmlString += '<td width="50">'+workLengthString+'</td>';				htmlString += '<td width="500">'+workGeneralComments+'</td>';				htmlString += '</tr></table>';				document.getElementById('workDetails').innerHTML = htmlString;				$('#workDetails').show();				// call get recordings here ----				getRecordings(currentWork);				}									var getRecordings = function(work){				$('#recordings').hide();				var cageProxy = new cageJSON();				cageProxy.setCallbackHandler(getRecordingsReturn);				cageProxy.setErrorHandler(myErrorHandler); 				cageProxy.getRecordings(work);										}						var getRecordingsReturn = function(recordings){				var numberOfRecordings = recordings.DATA.length;				var randomRecording = Math.floor((Math.random()*numberOfRecordings)+1);				if (numberOfRecordings){					//alert('there are recordings');					var recordTitle = recordings.DATA[randomRecording][1];					var recordPerformers = recordings.DATA[randomRecording][7];					var fileName = recordings.DATA[randomRecording][3];					var recordLabel = recordings.DATA[randomRecording][4];					htmlString =  ' <br /><br />';					htmlString += ' <p> There are ' +numberOfRecordings + ' recordings of ' + workName + ' in our database</p>' ;					htmlString += ' <p> Here is a random recording.</p>';					htmlString += '<table width="500" border="1">';					htmlString += '<tr class="even">';					htmlString += '<td>' + recordTitle + '</td>';					htmlString += '<td>' + recordPerformers + '</td>';					htmlString += '<td width="255"><img src="../db_images/Discog/Discimages/' + fileName + '"/></td>';					htmlString += '<td>' + recordLabel + '</td>';					if (numberOfRecordings > 1){					  htmlString += '<td> <a href = "javascript:getRecordings(currentWork)">Select Another </a></td>';					}					document.getElementById("recordings").innerHTML = htmlString; 					$('#recordings').show(900);				}else{										htmlString =  ' <br /><br />';					htmlString += ' <p>There are no recordings of ' + workName +'!';					document.getElementById("recordings").innerHTML = htmlString; 																				$('#recordings').show();														}			}			  // Error handler for the asynchronous functions.             var myErrorHandler = function(statusCode, statusMsg)             {                 alert('Status: ' + statusCode + ', ' + statusMsg);             } </script><!---- get selected work details ---><!--- get recordings, if any....---></head><body><div class="container"><!--- sidebar --->  <div class="sidebar1">    <ul class="nav">    	<cfoutput query="pianoWorks">      <li><a href="javascript:getAllDetails(#pianoworks.work_ID#);">#pianoWorks.Work_Title#</a></li>      </cfoutput>    </ul>    </div>       <!--- end sidebar --->         <div class="content">  <div class="firstMessage" id="firstMessage">    <h1>Instructions</h1>    <p>Select a prepared piano work on the left, and further information about that work will appear here.</p>    </div>	<div class="workDetails" id="workDetails">  <!--- here --->       </div>   <div class="recordings" id="recordings"> </div>       <!-- end .content --></div>  <!-- end .container --></div> <script type="text/javascript">	$(document).ready(function(e) {        $('#firstMessage').show();		$('#workDetails').hide();		$('#recordings').hide();    });	</script>  </body></html>